--DROP DATABASE IF EXISTS MYBASE;
--CREATE DATABASE MYBASE;

--ПОСТАВЩИК
DROP TABLE IF EXISTS S;
CREATE TABLE S
(
SNO 	INT,
SNAME 	VARCHAR(255),
STATUS	INT,
CITY	VARCHAR(255),
PRIMARY KEY (SNO)
--FOREIGN KEY (CITY) REFERENCES PRODUCT ON DELETE CASCADE ON UPDATE CASCADE,
--UNIQUE (CITY)
);

--ПРОДУКТ
DROP TABLE IF EXISTS P;
CREATE TABLE P
(
PNO 	INT,
PNAME 	VARCHAR(255),
COLOR 	VARCHAR(255),
WEIGHT	INT,
CITY	VARCHAR(255),
PRIMARY KEY (PNO)
);

--ПРОЕКТ
DROP TABLE IF EXISTS J;
CREATE TABLE J
(
JNO 	INT,
JNAME 	VARCHAR(255),
CITY	VARCHAR(255),
PRIMARY KEY (JNO)
);

--ПОСТАВКИ
DROP TABLE IF EXISTS SPJ;
CREATE TABLE SPJ
(
SNO 	INT,
PNO 	INT,
JNO	INT,
QTY	INT
);

--ALTER TABLE SUPPLIER ADD CONSTRAINT ACITY FOREIGN KEY (CITY) REFERENCES PRODUCT(CITY)  ON DELETE CASCADE ON UPDATE CASCADE;
--ALTER TABLE PRODUCT  ADD CONSTRAINT BCITY FOREIGN KEY (CITY) REFERENCES SUPPLIER(CITY) ON DELETE CASCADE ON UPDATE CASCADE;
--ALTER TABLE SUPPLIER DROP CONSTRAINT BCITY;

INSERT INTO S(SNO,SNAME,STATUS,CITY) VALUES(1,'АЛМАЗ',20,'СМОЛЕНСК');
INSERT INTO S(SNO,SNAME,STATUS,CITY) VALUES(2,'ЦИКЛОН',10,'ВЛАДИМИР');
INSERT INTO S(SNO,SNAME,STATUS,CITY) VALUES(3,'ДЕЛЬТА',30,'ВЛАДИМИР');
INSERT INTO S(SNO,SNAME,STATUS,CITY) VALUES(4,'ОРИОН',20,'СМОЛЕНСК');
INSERT INTO S(SNO,SNAME,STATUS,CITY) VALUES(5,'АРГОН',30,'ЯРОСЛАВЛЬ');

INSERT INTO P(PNO,PNAME,COLOR,WEIGHT,CITY) VALUES(1,'ГАЙКА','КРАСНЫЙ',12,'СМОЛЕНСК');
INSERT INTO P(PNO,PNAME,COLOR,WEIGHT,CITY) VALUES(2,'БОЛТ','ЗЕЛЕНЫЙ',17,'ВЛАДИМИР');
INSERT INTO P(PNO,PNAME,COLOR,WEIGHT,CITY) VALUES(3,'ВИНТ','СИНИЙ',17,'РЯЗАНЬ');
INSERT INTO P(PNO,PNAME,COLOR,WEIGHT,CITY) VALUES(4,'ВИНТ','КРАСНЫЙ',14,'СМОЛЕНСК');
INSERT INTO P(PNO,PNAME,COLOR,WEIGHT,CITY) VALUES(5,'ШАЙБА','СИНИЙ',12,'ВЛАДИМИР');
INSERT INTO P(PNO,PNAME,COLOR,WEIGHT,CITY) VALUES(6,'ШПУНТ','КРАСНЫЙ',19,'СМОЛЕНСК');

INSERT INTO J(JNO,JNAME,CITY) VALUES(1,'БАЙКАЛ','ВЛАДИМИР');
INSERT INTO J(JNO,JNAME,CITY) VALUES(2,'АНГАРА','РЯЗАНЬ');
INSERT INTO J(JNO,JNAME,CITY) VALUES(3,'ЕНИСЕЙ','ЯРОСЛАВЛЬ');
INSERT INTO J(JNO,JNAME,CITY) VALUES(4,'АЛТАЙ','ЯРОСЛАВЛЬ');
INSERT INTO J(JNO,JNAME,CITY) VALUES(5,'УРАЛ','СМОЛЕНСК');
INSERT INTO J(JNO,JNAME,CITY) VALUES(6,'АМУР','ТВЕРЬ');
INSERT INTO J(JNO,JNAME,CITY) VALUES(7,'АЛДАН','СМОЛЕНСК');

INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(1,1,1,200);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(1,1,4,700);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,3,1,400);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,3,2,200);

INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,3,3,200);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,3,4,500);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,3,5,600);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,3,6,400);

INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,3,7,800);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,5,2,100);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(3,3,1,200);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(2,4,2,500);

INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(4,6,3,300);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(4,6,7,300);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,2,2,200);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,2,4,100);

INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,5,5,500);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,5,7,100);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,6,2,200);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,1,4,100);

INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,3,4,200);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,4,4,800);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,5,4,400);
INSERT INTO SPJ(SNO,PNO,JNO,QTY) VALUES(5,6,4,100);
-----------------------------------------------------
--- ЗАПРОСЫ ВАРИАНТ № 4 ---

--SELECT J.JNAME FROM SPJ JOIN J ON SPJ.JNO = J.JNO
--WHERE SPJ.SNO = 1
 
--SELECT P.COLOR FROM P
--WHERE P.PNO IN (SELECT SPJ.PNO FROM SPJ WHERE SPJ.SNO = 1)

SELECT DISTINCT SPJ.PNO FROM J JOIN SPJ ON J.JNO = SPJ.JNO
WHERE J.CITY = 'СМОЛЕНСК';

--SELECT * FROM SPJ
--SELECT * FROM P
--SELECT * FROM J
